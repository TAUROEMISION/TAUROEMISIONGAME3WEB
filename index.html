<!DOCTYPE html>
<html lang="en-us">
<head>
    <meta charset="utf-8">
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    <title>Unity WebGL Player | TAUROEMISIONGAME2</title>
    <link rel="shortcut icon" href="TemplateData/favicon.ico">
    <link rel="stylesheet" href="TemplateData/style.css">
    <style>
        #chat-container {
            position: absolute; /* Cambiará a fixed en pantalla completa */
            top: 20px;
            left: 20px;
            background-color: rgba(255, 255, 255, 0.9);
            padding: 10px;
            border-radius: 5px;
            width: 300px;
            z-index: 2147483647; /* Asegura que esté encima */
            cursor: move;
            user-select: none;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.5);
            transition: all 0.3s ease; /* Suaviza las transiciones */
        }
        #chat-form {
            display: none;
        }
        #chatUl {
            list-style-type: none;
            padding: 0;
            max-height: 150px;
            overflow-y: auto;
        }
        #toggleChat {
            cursor: pointer;
        }
    </style>
</head>
<body>
    <!-- Unity Player -->
    <div id="unity-container" class="unity-desktop">
        <canvas id="unity-canvas" width="1242" height="975" tabindex="-1"></canvas>

        <!-- Chat -->
        <div id="chat-container">
            <button id="toggleChat">Charlar</button>
            <div id="chat-form">
                <form action="">
                    <div>
                        <label for="nombre">Nombre</label>
                        <input type="text" id="nombre" required>
                    </div>
                    <div>
                        <label for="mensaje">Mensaje</label>
                        <textarea id="mensaje" required></textarea>
                    </div>
                    <button type="button" id="btnEnviar">Enviar</button>
                </form>
            </div>
            <ul id="chatUl"></ul>
        </div>

        <div id="unity-loading-bar">
            <div id="unity-logo"></div>
            <div id="unity-progress-bar-empty">
                <div id="unity-progress-bar-full"></div>
            </div>
        </div>
        <div id="unity-warning"></div>
        <div id="unity-footer">
            <div id="unity-webgl-logo"></div>
            <div id="unity-fullscreen-button"></div>
            <div id="unity-build-title">TAUROEMISIONGAME2</div>
        </div>
    </div>

    <script>

        var container = document.querySelector("#unity-container");
        var canvas = document.querySelector("#unity-canvas");
        var loadingBar = document.querySelector("#unity-loading-bar");
        var progressBarFull = document.querySelector("#unity-progress-bar-full");
        var fullscreenButton = document.querySelector("#unity-fullscreen-button");
        var warningBanner = document.querySelector("#unity-warning");
  
        // Shows a temporary message banner/ribbon for a few seconds, or
        // a permanent error message on top of the canvas if type=='error'.
        // If type=='warning', a yellow highlight color is used.
        // Modify or remove this function to customize the visually presented
        // way that non-critical warnings and error messages are presented to the
        // user.
        function unityShowBanner(msg, type) {
          function updateBannerVisibility() {
            warningBanner.style.display = warningBanner.children.length ? 'block' : 'none';
          }
          var div = document.createElement('div');
          div.innerHTML = msg;
          warningBanner.appendChild(div);
          if (type == 'error') div.style = 'background: red; padding: 10px;';
          else {
            if (type == 'warning') div.style = 'background: yellow; padding: 10px;';
            setTimeout(function() {
              warningBanner.removeChild(div);
              updateBannerVisibility();
            }, 5000);
          }
          updateBannerVisibility();
        }
  
        var buildUrl = "Build";
        var loaderUrl = buildUrl + "/TAUROEMISIONGAME2WEB.loader.js";
        var config = {
          dataUrl: buildUrl + "/TAUROEMISIONGAME2WEB.data",
          frameworkUrl: buildUrl + "/TAUROEMISIONGAME2WEB.framework.js",
          codeUrl: buildUrl + "/TAUROEMISIONGAME2WEB.wasm",
          streamingAssetsUrl: "StreamingAssets",
          companyName: "DefaultCompany",
          productName: "TAUROEMISIONGAME2",
          productVersion: "1.0.2",
          showBanner: unityShowBanner,
        };
  
        // By default, Unity keeps WebGL canvas render target size matched with
        // the DOM size of the canvas element (scaled by window.devicePixelRatio)
        // Set this to false if you want to decouple this synchronization from
        // happening inside the engine, and you would instead like to size up
        // the canvas DOM size and WebGL render target sizes yourself.
        // config.matchWebGLToCanvasSize = false;
  
        if (/iPhone|iPad|iPod|Android/i.test(navigator.userAgent)) {
          // Mobile device style: fill the whole browser client area with the game canvas:
  
          var meta = document.createElement('meta');
          meta.name = 'viewport';
          meta.content = 'width=device-width, height=device-height, initial-scale=1.0, user-scalable=no, shrink-to-fit=yes';
          document.getElementsByTagName('head')[0].appendChild(meta);
          container.className = "unity-mobile";
          canvas.className = "unity-mobile";
  
          // To lower canvas resolution on mobile devices to gain some
          // performance, uncomment the following line:
          // config.devicePixelRatio = 1;
  
  
        } else {
          // Desktop style: Render the game canvas in a window that can be maximized to fullscreen:
  
          canvas.style.width = "960px";
          canvas.style.height = "600px";
        }
  
        loadingBar.style.display = "block";
  
        var script = document.createElement("script");
        script.src = loaderUrl;
        script.onload = () => {
          createUnityInstance(canvas, config, (progress) => {
            progressBarFull.style.width = 100 * progress + "%";
                }).then((unityInstance) => {
                  loadingBar.style.display = "none";
                  fullscreenButton.onclick = () => {
                    unityInstance.SetFullscreen(1);
                  };
                }).catch((message) => {
                  alert(message);
                });
              };
  
        document.body.appendChild(script);
  
      </script>

    <script>
        // Inicializar Firebase
        const app = firebase.initializeApp({
            apiKey: "AIzaSyBsT5gag1QnSkOylpBAywR4HWAkq-GoiJA",
            authDomain: "tauroemisiongame2.firebaseapp.com",
            databaseURL: "https://tauroemisiongame2-default-rtdb.europe-west1.firebasedatabase.app",
            projectId: "tauroemisiongame2",
            storageBucket: "tauroemisiongame2.appspot.com",
            messagingSenderId: "89770445112",
            appId: "1:89770445112:web:66eadc60fe6d9cf9e299cd"
        });

        const database = firebase.database(app);

        // DOM Elements
        const chatContainer = document.getElementById('chat-container');
        const chatForm = document.getElementById('chat-form');
        const chatUl = document.getElementById('chatUl');
        const btnEnviar = document.getElementById("btnEnviar");
        const txtNombre = document.getElementById("nombre");
        const txtMensaje = document.getElementById("mensaje");
        const toggleChat = document.getElementById('toggleChat');

        // Mantener el chat visible en modo pantalla completa
        document.addEventListener('fullscreenchange', () => {
            if (document.fullscreenElement) {
                chatContainer.style.position = 'fixed';
                chatContainer.style.top = '20px';
                chatContainer.style.left = '20px';
            } else {
                chatContainer.style.position = 'absolute';
            }
        });

        // Enviar mensajes
        btnEnviar.addEventListener('click', () => {
            const nombre = txtNombre.value.trim();
            const mensaje = txtMensaje.value.trim();
            if (nombre && mensaje) {
                database.ref('chat').push({ name: nombre, message: mensaje });
                txtMensaje.value = ''; // Limpia el campo mensaje
            } else {
                alert("Por favor, completa ambos campos.");
            }
        });

        // Escuchar mensajes nuevos
        database.ref('chat').on('value', (snapshot) => {
            chatUl.innerHTML = '';
            snapshot.forEach((child) => {
                const { name, message } = child.val();
                const li = document.createElement('li');
                li.innerHTML = `<b>${name}:</b> ${message}`;
                chatUl.appendChild(li);
            });
            chatUl.scrollTop = chatUl.scrollHeight; // Auto-scroll
        });

        // Mostrar/ocultar formulario de chat
        toggleChat.addEventListener('click', () => {
            chatForm.style.display = chatForm.style.display === 'none' ? 'block' : 'none';
        });
    </script>
</body>
</html>

</html>
